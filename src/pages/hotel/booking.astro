---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={`í˜¸í…” ì˜ˆì•½ - ${SITE_TITLE}`} description="ë¸”ë£¨ì™€ì¸ ë¦¬ì¡°íŠ¸ì™€ ì œíœ´ í˜¸í…”ë“¤ì„ í™•ì¸í•˜ê³  ì˜ˆì•½í•˜ì„¸ìš”." />
		<style is:global>
			main {
				width: 100%;
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			
			.hero {
				text-align: center;
				margin-bottom: 3rem;
				padding: 2rem;
				background: linear-gradient(135deg, #f0fdf4, #e6fffa);
				border-radius: 16px;
			}
			
			.hero h1 {
				font-size: 2.5rem;
				margin-bottom: 1rem;
				color: #065f46;
			}
			
			.hero p {
				font-size: 1.125rem;
				color: #047857;
			}
			
			.search-section {
				background: white;
				padding: 2rem;
				border-radius: 16px;
				box-shadow: 0 4px 6px rgba(0,0,0,0.05);
				margin-bottom: 3rem;
			}
			
			.search-form {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 1rem;
				align-items: end;
			}
			
			.form-group {
				display: flex;
				flex-direction: column;
			}
			
			.form-group label {
				margin-bottom: 0.5rem;
				font-weight: 600;
				color: #374151;
			}
			
			.form-group input,
			.form-group select {
				padding: 0.75rem;
				border: 2px solid #e5e7eb;
				border-radius: 8px;
				font-size: 1rem;
				transition: border-color 0.2s;
			}
			
			.form-group input:focus,
			.form-group select:focus {
				outline: none;
				border-color: #10b981;
			}
			
			.search-btn {
				padding: 0.75rem 2rem;
				background: #10b981;
				color: white;
				border: none;
				border-radius: 8px;
				font-size: 1rem;
				font-weight: 600;
				cursor: pointer;
				transition: background-color 0.2s;
			}
			
			.search-btn:hover {
				background: #059669;
			}
			
			.hotels-container {
				margin-top: 2rem !important;
			}
			
			/* ì¶”ê°€ í…Œì´ë¸” ê°•í™” */
			table.hotels-table {
				border: 3px solid #e5e7eb !important;
				border-radius: 16px !important;
				background: white !important;
				box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
			}
			
			table.hotels-table thead {
				background: linear-gradient(135deg, #10b981, #059669) !important;
			}
			
			table.hotels-table th {
				background: linear-gradient(135deg, #10b981, #059669) !important;
				color: white !important;
				font-weight: 700 !important;
			}
			
			table.hotels-table td {
				background: white !important;
				border-right: 1px solid #f1f5f9 !important;
			}
			
			table.hotels-table tbody tr:hover td {
				background: linear-gradient(135deg, #f0fdf9, #ecfdf5) !important;
			}
			
			.hotels-table {
				width: 100%;
				max-width: 1400px;
				margin: 0 auto;
				background: white;
				border-radius: 16px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
				overflow: hidden;
				border-collapse: collapse;
				border: 2px solid #e5e7eb;
			}
			
			.hotels-table thead {
				background: linear-gradient(135deg, #10b981, #059669);
				color: white;
			}
			
			.hotels-table th {
				padding: 1.5rem 1rem;
				font-weight: 600;
				text-align: left;
				border-bottom: 3px solid rgba(255, 255, 255, 0.2);
				border-right: 1px solid rgba(255, 255, 255, 0.2);
			}
			
			.hotels-table th:first-child {
				padding-left: 2rem;
			}
			
			.hotels-table th:last-child {
				text-align: center;
				border-right: none;
			}
			
			.hotels-table tbody tr {
				transition: all 0.3s ease;
				border-bottom: 2px solid #f1f5f9;
			}
			
			.hotels-table tbody tr:hover {
				background: linear-gradient(135deg, #f0fdf9, #ecfdf5);
				transform: scale(1.01);
				box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
			}
			
			.hotels-table td {
				padding: 1.5rem 1rem;
				vertical-align: top;
				border-right: 1px solid #f1f5f9;
			}
			
			.hotels-table td:first-child {
				padding-left: 2rem;
			}
			
			.hotels-table td:last-child {
				border-right: none;
			}
			
			.hotel-basic-info {
				display: flex;
				align-items: center;
				gap: 1.5rem;
			}
			
			.hotel-image {
				width: 120px;
				height: 90px;
				border-radius: 12px;
				background: linear-gradient(135deg, #f0fdf4, #dcfce7);
				flex-shrink: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #065f46;
				font-size: 1.5rem;
				font-weight: 600;
				border: 2px solid rgba(16, 185, 129, 0.2);
			}
			
			.hotel-image::before {
				content: 'ğŸ¨';
				font-size: 2rem;
			}
			
			.hotel-details h3 {
				font-size: 1.25rem;
				font-weight: 700;
				color: #111827;
				margin-bottom: 0.25rem;
			}
			
			.hotel-details .hotel-name-en {
				font-size: 0.9rem;
				color: #6b7280;
				margin-bottom: 0.5rem;
			}
			
			.hotel-details .hotel-address {
				color: #6b7280;
				font-size: 0.875rem;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}
			
			.amenities {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				max-width: 200px;
			}
			
			.amenity-tag {
				background: linear-gradient(135deg, #f0fdf4, #dcfce7);
				color: #065f46;
				padding: 0.375rem 0.75rem;
				border-radius: 20px;
				font-size: 0.75rem;
				font-weight: 500;
				border: 1px solid rgba(16, 185, 129, 0.2);
			}
			
			.price-cell {
				text-align: center;
			}
			
			.price {
				font-size: 1.5rem;
				font-weight: 800;
				color: #10b981;
				display: block;
				margin-bottom: 0.25rem;
			}
			
			.price-unit {
				font-size: 0.875rem;
				color: #6b7280;
			}
			
			.action-cell {
				text-align: center;
			}
			
			.book-btn {
				background: linear-gradient(135deg, #10b981, #059669) !important;
				color: white !important;
				border: none !important;
				border-radius: 50px !important;
				padding: 1rem 2rem !important;
				font-weight: 700 !important;
				font-size: 1rem !important;
				cursor: pointer !important;
				transition: all 0.3s ease !important;
				box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4) !important;
				text-transform: uppercase !important;
				letter-spacing: 0.8px !important;
				position: relative !important;
				overflow: hidden !important;
				text-decoration: none !important;
				display: inline-block !important;
				min-width: 180px !important;
				text-align: center !important;
			}
			
			.book-btn:hover {
				background: linear-gradient(135deg, #059669, #047857) !important;
				transform: translateY(-3px) scale(1.05) !important;
				box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5) !important;
			}
			
			.book-btn::before {
				content: '' !important;
				position: absolute !important;
				top: 0 !important;
				left: -100% !important;
				width: 100% !important;
				height: 100% !important;
				background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent) !important;
				transition: left 0.6s !important;
			}
			
			.book-btn:hover::before {
				left: 100% !important;
			}
			
			.loading {
				text-align: center;
				padding: 3rem;
				font-size: 1.125rem;
				color: #6b7280;
			}
			
			.error {
				text-align: center;
				padding: 3rem;
				color: #dc2626;
				background: #fef2f2;
				border-radius: 8px;
				margin: 2rem 0;
			}

			@media (max-width: 768px) {
				.search-form {
					grid-template-columns: 1fr;
				}
				
				.hotels-table {
					font-size: 0.875rem;
				}
				
				.hotels-table th,
				.hotels-table td {
					padding: 1rem 0.5rem;
				}
				
				.hotel-basic-info {
					flex-direction: column;
					gap: 1rem;
				}
				
				.hotel-image {
					width: 100px;
					height: 75px;
				}
				
				.amenities {
					max-width: 150px;
				}
				
				.price {
					font-size: 1.25rem;
				}
				
				.book-btn {
					padding: 0.75rem 1.5rem;
					font-size: 0.9rem;
				}
				
				.hero h1 {
					font-size: 2rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="hero">
				<h1>ğŸ¨ í˜¸í…” ì˜ˆì•½</h1>
				<p>í¸ì•ˆí•˜ê³  ëŸ­ì…”ë¦¬í•œ ìˆ™ë°•ì„ ìœ„í•œ í”„ë¦¬ë¯¸ì—„ í˜¸í…”ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”.</p>
			</div>

			<div class="search-section">
				<div class="search-form">
					<div class="form-group">
						<label for="checkin">ì²´í¬ì¸</label>
						<input type="date" id="checkin" name="checkin" />
					</div>
					<div class="form-group">
						<label for="checkout">ì²´í¬ì•„ì›ƒ</label>
						<input type="date" id="checkout" name="checkout" />
					</div>
					<div class="form-group">
						<label for="guests">íˆ¬ìˆ™ê°</label>
						<select id="guests" name="guests">
							<option value="1">ì„±ì¸ 1ëª…</option>
							<option value="2" selected>ì„±ì¸ 2ëª…</option>
							<option value="3">ì„±ì¸ 3ëª…</option>
							<option value="4">ì„±ì¸ 4ëª…</option>
						</select>
					</div>
					<div class="form-group">
						<button type="button" class="search-btn" id="search-btn">ê²€ìƒ‰í•˜ê¸°</button>
					</div>
				</div>
			</div>

			<div id="hotels-container">
				<div class="loading">í˜¸í…” ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
			</div>
		</main>

		<script>
			// ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì˜¤ëŠ˜, ë‚´ì¼)
			const today = new Date();
			const tomorrow = new Date(today);
			tomorrow.setDate(tomorrow.getDate() + 1);
			
			const checkinInput = document.getElementById('checkin') as HTMLInputElement;
			const checkoutInput = document.getElementById('checkout') as HTMLInputElement;
			
			checkinInput.value = today.toISOString().split('T')[0];
			checkoutInput.value = tomorrow.toISOString().split('T')[0];
			checkinInput.min = today.toISOString().split('T')[0];

			// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			document.getElementById('search-btn')?.addEventListener('click', () => {
				searchHotels();
			});

			// ì²´í¬ì¸ ë‚ ì§œ ë³€ê²½ ì‹œ ì²´í¬ì•„ì›ƒ ìµœì†Œ ë‚ ì§œ ì—…ë°ì´íŠ¸
			checkinInput.addEventListener('change', () => {
				const checkinDate = new Date(checkinInput.value);
				const nextDay = new Date(checkinDate);
				nextDay.setDate(nextDay.getDate() + 1);
				checkoutInput.min = nextDay.toISOString().split('T')[0];
				
				if (checkoutInput.value <= checkinInput.value) {
					checkoutInput.value = nextDay.toISOString().split('T')[0];
				}
			});

			// í˜¸í…” ê²€ìƒ‰/ë¡œë“œ í•¨ìˆ˜
			async function searchHotels() {
				const container = document.getElementById('hotels-container');
				if (!container) return;

				container.innerHTML = '<div class="loading">í˜¸í…”ì„ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>';

				try {
					const response = await fetch('/api/hotels');
					const hotels = await response.json();

					// API ì‘ë‹µì´ ì—ëŸ¬ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²½ìš° (ë¡œì»¬ í™˜ê²½)
					if (hotels.error || hotels.development) {
						container.innerHTML = `
							<div class="error">
								<h3>âš ï¸ ì„œë¹„ìŠ¤ ì•ˆë‚´</h3>
								<p>í˜¸í…” ì˜ˆì•½ ê¸°ëŠ¥ì€ ë°°í¬ í™˜ê²½ì—ì„œë§Œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
								<p>í˜„ì¬ëŠ” ë¡œì»¬ ê°œë°œ í™˜ê²½ì´ë¯€ë¡œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
							</div>
						`;
						
						// ê°œë°œí™˜ê²½ìš© ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
						showSampleHotels();
						return;
					}

					if (hotels.length === 0) {
						container.innerHTML = '<div class="loading">ë“±ë¡ëœ í˜¸í…”ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
						return;
					}

					displayHotels(hotels);

				} catch (error) {
					console.error('Hotels fetch error:', error);
					container.innerHTML = `
						<div class="error">
							<h3>âš ï¸ ì„œë¹„ìŠ¤ ì•ˆë‚´</h3>
							<p>í˜¸í…” ì˜ˆì•½ ê¸°ëŠ¥ì€ ë°°í¬ í™˜ê²½ì—ì„œë§Œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
							<p>í˜„ì¬ëŠ” ë¡œì»¬ ê°œë°œ í™˜ê²½ì´ë¯€ë¡œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
						</div>
					`;
					
					// ê°œë°œí™˜ê²½ìš© ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
					showSampleHotels();
				}
			}

			// ìƒ˜í”Œ í˜¸í…” ë°ì´í„° í‘œì‹œ (ê°œë°œí™˜ê²½ìš©)
			function showSampleHotels() {
				const sampleHotels = [
					{
						id: 1,
						name: "ë¸”ë£¨ì™€ì¸ ë¦¬ì¡°íŠ¸",
						nameEn: "BlueWine Resort",
						address: "ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œ ì• ì›”ì í•´ì•ˆë¡œ 123",
						images: [],
						amenities: ["ê³¨í”„ì¥", "ìŠ¤íŒŒ", "ìˆ˜ì˜ì¥", "ë ˆìŠ¤í† ë‘", "ë¬´ë£ŒWiFi"],
						roomTypes: [
							{
								id: 1,
								name: "ì˜¤ì…˜ë·° ìŠ¤ìœ„íŠ¸",
								basePrice: 350000
							},
							{
								id: 2,
								name: "ê°€ë“ ë·° ë””ëŸ­ìŠ¤",
								basePrice: 250000
							},
							{
								id: 3,
								name: "ìŠ¤íƒ ë‹¤ë“œ ë£¸",
								basePrice: 180000
							}
						]
					}
				];
				
				setTimeout(() => {
					displayHotels(sampleHotels);
				}, 1000);
			}

			// í˜¸í…” ëª©ë¡ í‘œì‹œ
			function displayHotels(hotels: any[]) {
				const container = document.getElementById('hotels-container');
				if (!container) return;

				// í…Œì´ë¸” ìƒì„±
				const table = document.createElement('table');
				table.className = 'hotels-table';

				// í…Œì´ë¸” í—¤ë”
				const thead = document.createElement('thead');
				thead.innerHTML = `
					<tr>
						<th>í˜¸í…” ì •ë³´</th>
						<th>í¸ì˜ì‹œì„¤</th>
						<th>ê°€ê²© (1ë°•)</th>
						<th>ì˜ˆì•½</th>
					</tr>
				`;
				table.appendChild(thead);

				// í…Œì´ë¸” ë°”ë””
				const tbody = document.createElement('tbody');
				
				hotels.forEach(hotel => {
					const minPrice = Math.min(...hotel.roomTypes.map((rt: any) => rt.basePrice));
					const amenities = Array.isArray(hotel.amenities) ? hotel.amenities : [];

					const row = document.createElement('tr');
					row.innerHTML = `
						<td>
							<div class="hotel-basic-info">
								<div class="hotel-image" title="${hotel.name}"></div>
								<div class="hotel-details">
									<h3>${hotel.name}</h3>
									${hotel.nameEn ? `<div class="hotel-name-en">${hotel.nameEn}</div>` : ''}
									<div class="hotel-address">ğŸ“ ${hotel.address}</div>
								</div>
							</div>
						</td>
						<td>
							<div class="amenities">
								${amenities.slice(0, 5).map((amenity: string) => `
									<span class="amenity-tag">${amenity}</span>
								`).join('')}
								${amenities.length > 5 ? `<span class="amenity-tag">+${amenities.length - 5}</span>` : ''}
							</div>
						</td>
						<td class="price-cell">
							<span class="price">â‚©${minPrice.toLocaleString()}</span>
							<div class="price-unit">/ ë°•</div>
						</td>
						<td class="action-cell">
							<button class="book-btn" onclick="goToHotelDetail(${hotel.id})">
								ìƒì„¸ë³´ê¸° & ì˜ˆì•½
							</button>
						</td>
					`;
					tbody.appendChild(row);
				});

				table.appendChild(tbody);

				// ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ì„¤ì •
				container.className = 'hotels-container';
				container.innerHTML = '';
				container.appendChild(table);
			}

			// í˜¸í…” ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
			function goToHotelDetail(hotelId: number) {
				const checkin = (document.getElementById('checkin') as HTMLInputElement).value;
				const checkout = (document.getElementById('checkout') as HTMLInputElement).value;
				const guests = (document.getElementById('guests') as HTMLSelectElement).value;
				
				const params = new URLSearchParams({
					checkin,
					checkout,
					guests
				});
				
				window.location.href = `/hotel/${hotelId}?${params.toString()}`;
			}

			// ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ window ê°ì²´ì— í• ë‹¹
			(window as any).goToHotelDetail = goToHotelDetail;

			// í˜ì´ì§€ ë¡œë“œ ì‹œ í˜¸í…” ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
			document.addEventListener('DOMContentLoaded', () => {
				searchHotels();
			});
		</script>

		<Footer />
	</body>
</html>
