---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={`ì˜ˆì•½ ì¡°íšŒ - ${SITE_TITLE}`} description="í˜¸í…” ì˜ˆì•½ ì¡°íšŒ ë° ê´€ë¦¬" />
		<style is:global>
			main {
				width: 100%;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			
			.hero {
				text-align: center;
				margin-bottom: 3rem;
				padding: 2rem;
				background: linear-gradient(135deg, #f0fdf4, #e6fffa);
				border-radius: 16px;
			}
			
			.hero h1 {
				font-size: 2rem;
				margin-bottom: 1rem;
				color: #065f46;
			}
			
			.hero p {
				color: #047857;
			}
			
			.search-section {
				background: white;
				padding: 2rem;
				border-radius: 16px;
				box-shadow: 0 4px 6px rgba(0,0,0,0.05);
				margin-bottom: 2rem;
			}
			
			.search-title {
				font-size: 1.25rem;
				font-weight: 700;
				margin-bottom: 1.5rem;
				color: #111827;
			}
			
			.search-form {
				display: flex;
				gap: 1rem;
				align-items: end;
			}
			
			.form-group {
				flex: 1;
				display: flex;
				flex-direction: column;
			}
			
			.form-group label {
				margin-bottom: 0.5rem;
				font-weight: 600;
				color: #374151;
			}
			
			.form-group input {
				padding: 0.75rem;
				border: 2px solid #e5e7eb;
				border-radius: 8px;
				font-size: 1rem;
				transition: border-color 0.2s;
			}
			
			.form-group input:focus {
				outline: none;
				border-color: #10b981;
			}
			
			.search-btn {
				padding: 1.25rem 3rem;
				background: linear-gradient(135deg, #10b981, #059669);
				color: white;
				border: none;
				border-radius: 50px;
				font-size: 1.2rem;
				font-weight: 800;
				cursor: pointer;
				transition: all 0.4s ease;
				box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
				text-transform: uppercase;
				letter-spacing: 1px;
				white-space: nowrap;
				position: relative;
				overflow: hidden;
				min-width: 180px;
			}
			
			.search-btn:hover {
				background: linear-gradient(135deg, #059669, #047857);
				transform: translateY(-3px) scale(1.05);
				box-shadow: 0 12px 35px rgba(16, 185, 129, 0.5);
			}
			
			.search-btn:disabled {
				background: linear-gradient(135deg, #d1d5db, #9ca3af);
				cursor: not-allowed;
				transform: none;
				box-shadow: none;
			}
			
			.search-btn::before {
				content: '';
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
				transition: left 0.6s;
			}
			
			.search-btn:hover::before {
				left: 100%;
			}
			
			.search-btn::after {
				content: 'ğŸ”';
				position: absolute;
				right: -25px;
				top: 50%;
				transform: translateY(-50%);
				font-size: 1.2rem;
				transition: all 0.4s ease;
				opacity: 0;
			}
			
			.search-btn:hover::after {
				right: 15px;
				opacity: 1;
			}
			
			.result-section {
				background: white;
				border-radius: 16px;
				box-shadow: 0 4px 6px rgba(0,0,0,0.05);
				overflow: hidden;
			}
			
			.reservation-header {
				background: #10b981;
				color: white;
				padding: 1.5rem;
				text-align: center;
			}
			
			.reservation-code {
				font-size: 1.5rem;
				font-weight: 700;
				font-family: 'Courier New', monospace;
				letter-spacing: 2px;
				margin-bottom: 0.5rem;
			}
			
			.reservation-status {
				opacity: 0.9;
			}
			
			.reservation-details {
				padding: 2rem;
			}
			
			.detail-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 1.5rem;
				margin-bottom: 2rem;
			}
			
			.detail-item {
				display: flex;
				flex-direction: column;
			}
			
			.detail-label {
				font-size: 0.875rem;
				color: #6b7280;
				font-weight: 500;
				margin-bottom: 0.25rem;
			}
			
			.detail-value {
				font-weight: 600;
				color: #111827;
			}
			
			.status-section {
				border-top: 1px solid #e5e7eb;
				padding-top: 1.5rem;
				margin-top: 1.5rem;
			}
			
			.status-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 1rem;
				margin-bottom: 1.5rem;
			}
			
			.status-item {
				text-align: center;
				padding: 1rem;
				background: #f9fafb;
				border-radius: 8px;
			}
			
			.status-label {
				font-size: 0.75rem;
				color: #6b7280;
				margin-bottom: 0.5rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}
			
			.status-badge {
				padding: 0.5rem 1rem;
				border-radius: 999px;
				font-size: 0.875rem;
				font-weight: 600;
			}
			
			.status-confirmed {
				background: #d1fae5;
				color: #065f46;
			}
			
			.status-pending {
				background: #fef3c7;
				color: #92400e;
			}
			
			.status-cancelled {
				background: #fee2e2;
				color: #991b1b;
			}
			
			.price-total {
				text-align: center;
				font-size: 1.25rem;
				font-weight: 700;
				color: #10b981;
			}
			
			.contact-info {
				background: #f0fdf4;
				border-radius: 8px;
				padding: 1rem;
				margin-top: 1.5rem;
			}
			
			.contact-title {
				font-weight: 600;
				color: #065f46;
				margin-bottom: 0.5rem;
			}
			
			.contact-text {
				font-size: 0.875rem;
				color: #047857;
				line-height: 1.5;
			}
			
			.error {
				background: #fef2f2;
				border: 1px solid #fecaca;
				color: #b91c1c;
				padding: 1.5rem;
				border-radius: 8px;
				text-align: center;
			}
			
			.loading {
				text-align: center;
				padding: 2rem;
				color: #6b7280;
			}
			
			.empty-state {
				text-align: center;
				padding: 3rem 2rem;
				color: #6b7280;
			}
			
			.empty-icon {
				font-size: 3rem;
				margin-bottom: 1rem;
			}

			@media (max-width: 768px) {
				.search-form {
					flex-direction: column;
					align-items: stretch;
				}
				
				.search-btn {
					margin-top: 1rem;
				}
				
				.detail-grid,
				.status-grid {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="hero">
				<h1>ğŸ” ì˜ˆì•½ ì¡°íšŒ</h1>
				<p>ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¡œ ì˜ˆì•½ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”.</p>
			</div>

			<div class="search-section">
				<div class="search-title">ì˜ˆì•½ ì¡°íšŒí•˜ê¸°</div>
				<div class="search-form">
					<div class="form-group">
						<label for="reservation-code">ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸</label>
						<input 
							type="text" 
							id="reservation-code" 
							placeholder="ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ABC12345)"
							maxlength="10"
							style="text-transform: uppercase;"
						/>
					</div>
					<button type="button" class="search-btn" id="search-btn">
						ì¡°íšŒí•˜ê¸°
					</button>
				</div>
			</div>

			<div id="result-container"></div>
		</main>

		<script>
			// ì…ë ¥ í•„ë“œ ëŒ€ë¬¸ì ë³€í™˜
			document.getElementById('reservation-code')?.addEventListener('input', (e) => {
				const target = e.target as HTMLInputElement;
				target.value = target.value.toUpperCase();
			});

			// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			document.getElementById('search-btn')?.addEventListener('click', () => {
				searchReservation();
			});

			// ì—”í„°í‚¤ ì…ë ¥ ì‹œ ê²€ìƒ‰
			document.getElementById('reservation-code')?.addEventListener('keypress', (e) => {
				if (e.key === 'Enter') {
					searchReservation();
				}
			});

			// ì˜ˆì•½ ì¡°íšŒ í•¨ìˆ˜
			async function searchReservation() {
				const codeInput = document.getElementById('reservation-code') as HTMLInputElement;
				const searchBtn = document.getElementById('search-btn') as HTMLButtonElement;
				const resultContainer = document.getElementById('result-container');

				if (!resultContainer) return;

				const reservationCode = codeInput.value.trim();

				if (!reservationCode) {
					showError('ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
					return;
				}

				if (reservationCode.length < 6) {
					showError('ì˜¬ë°”ë¥¸ ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
					return;
				}

				// ë¡œë”© ìƒíƒœ
				searchBtn.disabled = true;
				searchBtn.textContent = 'ì¡°íšŒ ì¤‘...';
				resultContainer.innerHTML = '<div class="loading">ì˜ˆì•½ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

				try {
					const response = await fetch(`/api/reservations/${reservationCode}`);
					const reservation = await response.json();
					
					// API ì‘ë‹µì´ ì—ëŸ¬ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²½ìš° (ë¡œì»¬ í™˜ê²½)
					if (reservation.error || reservation.development) {
						// ê°œë°œí™˜ê²½ìš© ìƒ˜í”Œ ë°ì´í„°
						if (reservationCode === 'SAMPLE123') {
							showSampleReservation();
						} else {
							showError('ê°œë°œí™˜ê²½ì—ì„œëŠ” "SAMPLE123"ì„ ì…ë ¥í•´ë³´ì„¸ìš”.');
						}
						return;
					}
					
					// 404ë‚˜ ë‹¤ë¥¸ ì—ëŸ¬ì¸ ê²½ìš°
					if (!response.ok) {
						if (response.status === 404) {
							throw new Error('í•´ë‹¹ ì˜ˆì•½ ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜ˆì•½ ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
						}
						throw new Error('ì˜ˆì•½ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					}

					displayReservation(reservation);

				} catch (error) {
					console.error('Search error:', error);
					
					// ê°œë°œí™˜ê²½ì—ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
					if (reservationCode === 'SAMPLE123') {
						showSampleReservation();
					} else {
						showError(error instanceof Error ? error.message : 'ì˜ˆì•½ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					}
				} finally {
					searchBtn.disabled = false;
					searchBtn.textContent = 'ì¡°íšŒí•˜ê¸°';
				}
			}

			// ìƒ˜í”Œ ì˜ˆì•½ ë°ì´í„° í‘œì‹œ (ê°œë°œí™˜ê²½ìš©)
			function showSampleReservation() {
				const sampleReservation = {
					reservationCode: 'SAMPLE123',
					hotel: {
						name: 'ë¸”ë£¨ì™€ì¸ ë¦¬ì¡°íŠ¸',
						address: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œ ì• ì›”ì í•´ì•ˆë¡œ 123',
						phone: '064-123-4567',
						checkInTime: '15:00',
						checkOutTime: '11:00'
					},
					roomType: {
						name: 'ì˜¤ì…˜ë·° ìŠ¤ìœ„íŠ¸',
						description: 'ë„“ì€ ë°”ë‹¤ ì „ë§ì„ ê°ìƒí•  ìˆ˜ ìˆëŠ” í”„ë¦¬ë¯¸ì—„ ìŠ¤ìœ„íŠ¸ë£¸ì…ë‹ˆë‹¤.',
						bedType: 'í‚¹ë² ë“œ'
					},
					room: {
						roomNumber: '501',
						floor: 5
					},
					guestInfo: {
						name: 'ìƒ˜í”Œ ê³ ê°',
						phone: '010-1234-5678',
						email: 'sample@example.com'
					},
					dates: {
						checkInDate: '2024-12-25',
						checkOutDate: '2024-12-27',
						totalNights: 2
					},
					occupancy: {
						adults: 2,
						children: 0,
						total: 2
					},
					pricing: {
						totalAmount: 700000,
						pricePerNight: 350000
					},
					status: {
						reservation: 1,
						reservationText: 'ì˜ˆì•½ í™•ì •',
						payment: 0,
						paymentText: 'ë¯¸ê²°ì œ'
					},
					specialRequests: 'ëŠ¦ì€ ì²´í¬ì¸ ìš”ì²­',
					createdAt: new Date().toISOString()
				};
				
				setTimeout(() => {
					displayReservation(sampleReservation);
				}, 1000);
			}

			// ì˜ˆì•½ ì •ë³´ í‘œì‹œ
			function displayReservation(reservation: any) {
				const resultContainer = document.getElementById('result-container');
				if (!resultContainer) return;

				const checkinDate = new Date(reservation.dates.checkInDate);
				const checkoutDate = new Date(reservation.dates.checkOutDate);
				const createdDate = new Date(reservation.createdAt);

				// ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
				const getStatusClass = (status: number) => {
					switch (status) {
						case 0: return 'status-cancelled';
						case 1: return 'status-confirmed';
						case 2: return 'status-confirmed';
						case 3: return 'status-confirmed';
						default: return 'status-pending';
					}
				};

				const getPaymentStatusClass = (status: number) => {
					switch (status) {
						case 0: return 'status-pending';
						case 1: return 'status-confirmed';
						case 2: return 'status-cancelled';
						default: return 'status-pending';
					}
				};

				resultContainer.innerHTML = `
					<div class="result-section">
						<div class="reservation-header">
							<div class="reservation-code">${reservation.reservationCode}</div>
							<div class="reservation-status">${reservation.hotel.name}</div>
						</div>

						<div class="reservation-details">
							<div class="detail-grid">
								<div class="detail-item">
									<span class="detail-label">íˆ¬ìˆ™ê°</span>
									<span class="detail-value">${reservation.guestInfo.name}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì—°ë½ì²˜</span>
									<span class="detail-value">${reservation.guestInfo.phone}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ê°ì‹¤</span>
									<span class="detail-value">${reservation.roomType.name}${reservation.room ? ` (${reservation.room.roomNumber}í˜¸)` : ''}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì¹¨ëŒ€ íƒ€ì…</span>
									<span class="detail-value">${reservation.roomType.bedType || '-'}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì²´í¬ì¸</span>
									<span class="detail-value">${formatDate(checkinDate)}<br><small>(${reservation.hotel.checkInTime})</small></span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì²´í¬ì•„ì›ƒ</span>
									<span class="detail-value">${formatDate(checkoutDate)}<br><small>(${reservation.hotel.checkOutTime})</small></span>
								</div>
								<div class="detail-item">
									<span class="detail-label">íˆ¬ìˆ™ê¸°ê°„</span>
									<span class="detail-value">${reservation.dates.totalNights}ë°•</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">íˆ¬ìˆ™ê°</span>
									<span class="detail-value">ì„±ì¸ ${reservation.occupancy.adults}ëª…${reservation.occupancy.children > 0 ? `, ì•„ë™ ${reservation.occupancy.children}ëª…` : ''}</span>
								</div>
							</div>

							${reservation.specialRequests ? `
								<div class="detail-item" style="margin-bottom: 1.5rem;">
									<span class="detail-label">íŠ¹ë³„ ìš”ì²­ì‚¬í•­</span>
									<span class="detail-value" style="white-space: pre-wrap;">${reservation.specialRequests}</span>
								</div>
							` : ''}

							<div class="status-section">
								<div class="status-grid">
									<div class="status-item">
										<div class="status-label">ì˜ˆì•½ ìƒíƒœ</div>
										<div class="status-badge ${getStatusClass(reservation.status.reservation)}">
											${reservation.status.reservationText}
										</div>
									</div>
									<div class="status-item">
										<div class="status-label">ê²°ì œ ìƒíƒœ</div>
										<div class="status-badge ${getPaymentStatusClass(reservation.status.payment)}">
											${reservation.status.paymentText}
										</div>
									</div>
									<div class="status-item">
										<div class="status-label">ì´ ê²°ì œ ê¸ˆì•¡</div>
										<div class="price-total">â‚©${reservation.pricing.totalAmount.toLocaleString()}</div>
									</div>
								</div>

								<div style="text-align: center; color: #6b7280; font-size: 0.875rem; margin-top: 1rem;">
									ì˜ˆì•½ì¼ì‹œ: ${formatDateTime(createdDate)}
								</div>

								<div class="contact-info">
									<div class="contact-title">í˜¸í…” ì—°ë½ì²˜</div>
									<div class="contact-text">
										ğŸ“ ${reservation.hotel.address}<br>
										ğŸ“ ${reservation.hotel.phone}<br><br>
										â€¢ ì˜ˆì•½ ë³€ê²½/ì·¨ì†ŒëŠ” ì²´í¬ì¸ 1ì¼ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤<br>
										â€¢ ê²°ì œëŠ” ì²´í¬ì¸ ì‹œ í˜¸í…”ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤<br>
										â€¢ ë¬¸ì˜ì‚¬í•­ì€ í˜¸í…”ë¡œ ì§ì ‘ ì—°ë½ ë°”ëë‹ˆë‹¤
									</div>
								</div>
							</div>
						</div>
					</div>
				`;
			}

			// ì˜¤ë¥˜ í‘œì‹œ
			function showError(message: string) {
				const resultContainer = document.getElementById('result-container');
				if (resultContainer) {
					resultContainer.innerHTML = `
						<div class="error">
							<div style="font-size: 2rem; margin-bottom: 1rem;">âŒ</div>
							<div>${message}</div>
						</div>
					`;
				}
			}

			// ë‚ ì§œ í¬ë§·íŒ…
			function formatDate(date: Date): string {
				return date.toLocaleDateString('ko-KR', {
					year: 'numeric',
					month: 'long',
					day: 'numeric',
					weekday: 'short'
				});
			}

			// ë‚ ì§œì‹œê°„ í¬ë§·íŒ…
			function formatDateTime(date: Date): string {
				return date.toLocaleString('ko-KR', {
					year: 'numeric',
					month: '2-digit',
					day: '2-digit',
					hour: '2-digit',
					minute: '2-digit'
				});
			}

			// í˜ì´ì§€ ë¡œë“œ ì‹œ URLì—ì„œ ì½”ë“œ í™•ì¸
			document.addEventListener('DOMContentLoaded', () => {
				const urlParams = new URLSearchParams(window.location.search);
				const code = urlParams.get('code');
				
				if (code) {
					const input = document.getElementById('reservation-code') as HTMLInputElement;
					if (input) {
						input.value = code.toUpperCase();
						searchReservation();
					}
				}
			});
		</script>

		<Footer />
	</body>
</html>
