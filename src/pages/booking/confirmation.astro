---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={`ì˜ˆì•½ í™•ì¸ - ${SITE_TITLE}`} description="í˜¸í…” ì˜ˆì•½ í™•ì¸ í˜ì´ì§€" />
		<style is:global>
			main {
				width: 100%;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			
			.confirmation-container {
				background: white;
				border-radius: 16px;
				padding: 2rem;
				box-shadow: 0 8px 24px rgba(0,0,0,0.12);
				text-align: center;
			}
			
			.success-icon {
				font-size: 4rem;
				margin-bottom: 1rem;
			}
			
			.success-title {
				font-size: 2rem;
				font-weight: 700;
				color: #10b981;
				margin-bottom: 1rem;
			}
			
			.success-message {
				color: #6b7280;
				margin-bottom: 2rem;
				line-height: 1.6;
			}
			
			.reservation-details {
				background: #f9fafb;
				border-radius: 12px;
				padding: 1.5rem;
				margin: 2rem 0;
				text-align: left;
			}
			
			.reservation-code {
				text-align: center;
				margin-bottom: 1.5rem;
			}
			
			.code-label {
				font-size: 0.875rem;
				color: #6b7280;
				margin-bottom: 0.5rem;
			}
			
			.code-value {
				font-size: 1.5rem;
				font-weight: 700;
				color: #10b981;
				font-family: 'Courier New', monospace;
				letter-spacing: 2px;
			}
			
			.detail-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 1rem;
				margin-bottom: 1.5rem;
			}
			
			.detail-item {
				display: flex;
				flex-direction: column;
			}
			
			.detail-label {
				font-size: 0.875rem;
				color: #6b7280;
				font-weight: 500;
				margin-bottom: 0.25rem;
			}
			
			.detail-value {
				font-weight: 600;
				color: #111827;
			}
			
			.status-section {
				border-top: 1px solid #e5e7eb;
				padding-top: 1.5rem;
				margin-top: 1.5rem;
			}
			
			.status-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 0.75rem;
			}
			
			.status-label {
				color: #6b7280;
			}
			
			.status-badge {
				padding: 0.25rem 0.75rem;
				border-radius: 999px;
				font-size: 0.75rem;
				font-weight: 600;
			}
			
			.status-confirmed {
				background: #d1fae5;
				color: #065f46;
			}
			
			.status-pending {
				background: #fef3c7;
				color: #92400e;
			}
			
			.important-info {
				background: #eff6ff;
				border: 1px solid #bfdbfe;
				border-radius: 8px;
				padding: 1rem;
				margin: 1.5rem 0;
			}
			
			.important-title {
				font-weight: 600;
				color: #1e40af;
				margin-bottom: 0.5rem;
			}
			
			.important-text {
				font-size: 0.875rem;
				color: #1e40af;
				line-height: 1.5;
			}
			
			.action-buttons {
				display: flex;
				gap: 1.5rem;
				justify-content: center;
				flex-wrap: wrap;
				margin-top: 3rem;
			}
			
			.btn {
				padding: 1.25rem 2.5rem;
				border-radius: 50px;
				text-decoration: none;
				font-weight: 800;
				font-size: 1.1rem;
				text-transform: uppercase;
				letter-spacing: 0.8px;
				transition: all 0.4s ease;
				position: relative;
				overflow: hidden;
				min-width: 200px;
				text-align: center;
			}
			
			.btn-primary {
				background: linear-gradient(135deg, #10b981, #059669);
				color: white;
				border: none;
				box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
			}
			
			.btn-primary:hover {
				background: linear-gradient(135deg, #059669, #047857);
				transform: translateY(-4px) scale(1.05);
				box-shadow: 0 15px 35px rgba(16, 185, 129, 0.5);
			}
			
			.btn-secondary {
				background: linear-gradient(135deg, #f8fafc, #e2e8f0);
				color: #374151;
				border: 2px solid #cbd5e1;
				box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
			}
			
			.btn-secondary:hover {
				background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
				color: #1f2937;
				border-color: #94a3b8;
				transform: translateY(-3px) scale(1.03);
				box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
			}
			
			.btn::before {
				content: '';
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
				transition: left 0.6s;
			}
			
			.btn:hover::before {
				left: 100%;
			}
			
			.loading {
				text-align: center;
				padding: 3rem;
			}
			
			.error {
				text-align: center;
				padding: 3rem;
				color: #dc2626;
			}
			
			.error-icon {
				font-size: 3rem;
				margin-bottom: 1rem;
			}

			@media (max-width: 768px) {
				.detail-grid {
					grid-template-columns: 1fr;
				}
				
				.action-buttons {
					flex-direction: column;
					align-items: center;
				}
				
				.btn {
					width: 100%;
					max-width: 300px;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div id="confirmation-container">
				<div class="loading">ì˜ˆì•½ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
			</div>
		</main>

		<script>
			// URLì—ì„œ ì˜ˆì•½ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
			const urlParams = new URLSearchParams(window.location.search);
			const reservationCode = urlParams.get('code');

			if (!reservationCode) {
				window.location.href = '/hotels';
			}

			// ì˜ˆì•½ ì •ë³´ ë¡œë“œ
			async function loadReservationDetails() {
				const container = document.getElementById('confirmation-container');
				if (!container) return;

				try {
					const response = await fetch(`/api/reservations/${reservationCode}`);
					const reservation = await response.json();

					// API ì‘ë‹µì´ ì—ëŸ¬ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²½ìš° (ë¡œì»¬ í™˜ê²½)
					if (reservation.error || reservation.development) {
						// ê°œë°œí™˜ê²½ìš© ìƒ˜í”Œ ë°ì´í„°
						showSampleReservation();
						return;
					}
					
					if (!response.ok) {
						throw new Error('ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
					}

					displayReservation(reservation);

				} catch (error) {
					console.error('Reservation fetch error:', error);
					
					// ê°œë°œí™˜ê²½ì—ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
					if (reservationCode === 'SAMPLE123') {
						showSampleReservation();
					} else {
						showError('ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
					}
				}
			}

			// ìƒ˜í”Œ ì˜ˆì•½ ë°ì´í„° í‘œì‹œ (ê°œë°œí™˜ê²½ìš©)
			function showSampleReservation() {
				const sampleReservation = {
					reservationCode: 'SAMPLE123',
					hotel: {
						name: 'ë¸”ë£¨ì™€ì¸ ë¦¬ì¡°íŠ¸',
						address: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œ ì• ì›”ì í•´ì•ˆë¡œ 123',
						phone: '064-123-4567',
						checkInTime: '15:00',
						checkOutTime: '11:00'
					},
					roomType: {
						name: 'ì˜¤ì…˜ë·° ìŠ¤ìœ„íŠ¸',
						description: 'ë„“ì€ ë°”ë‹¤ ì „ë§ì„ ê°ìƒí•  ìˆ˜ ìˆëŠ” í”„ë¦¬ë¯¸ì—„ ìŠ¤ìœ„íŠ¸ë£¸ì…ë‹ˆë‹¤.',
						bedType: 'í‚¹ë² ë“œ'
					},
					room: null,
					guestInfo: {
						name: 'ìƒ˜í”Œ ê³ ê°',
						phone: '010-1234-5678',
						email: 'sample@example.com'
					},
					dates: {
						checkInDate: '2024-12-25',
						checkOutDate: '2024-12-27',
						totalNights: 2
					},
					occupancy: {
						adults: 2,
						children: 0,
						total: 2
					},
					pricing: {
						totalAmount: 700000,
						pricePerNight: 350000
					},
					status: {
						reservation: 1,
						reservationText: 'ì˜ˆì•½ í™•ì •',
						payment: 0,
						paymentText: 'ë¯¸ê²°ì œ'
					},
					specialRequests: null,
					createdAt: new Date().toISOString()
				};
				
				setTimeout(() => {
					displayReservation(sampleReservation);
				}, 1000);
			}

			// ì˜ˆì•½ ì •ë³´ í‘œì‹œ
			function displayReservation(reservation: any) {
				const container = document.getElementById('confirmation-container');
				if (!container) return;

				const checkinDate = new Date(reservation.dates.checkInDate);
				const checkoutDate = new Date(reservation.dates.checkOutDate);

				container.innerHTML = `
					<div class="confirmation-container">
						<div class="success-icon">âœ…</div>
						<h1 class="success-title">ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
						<p class="success-message">
							ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•´ ì£¼ì‹œê³ ,<br>
							ì²´í¬ì¸ ì‹œ ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ë¥¼ ì œì‹œí•´ ì£¼ì„¸ìš”.
						</p>

						<div class="reservation-details">
							<div class="reservation-code">
								<div class="code-label">ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸</div>
								<div class="code-value">${reservation.reservationCode}</div>
							</div>

							<div class="detail-grid">
								<div class="detail-item">
									<span class="detail-label">í˜¸í…”</span>
									<span class="detail-value">${reservation.hotel.name}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ê°ì‹¤</span>
									<span class="detail-value">${reservation.roomType.name}</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì²´í¬ì¸</span>
									<span class="detail-value">${formatDate(checkinDate)} (${reservation.hotel.checkInTime})</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">ì²´í¬ì•„ì›ƒ</span>
									<span class="detail-value">${formatDate(checkoutDate)} (${reservation.hotel.checkOutTime})</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">íˆ¬ìˆ™ê¸°ê°„</span>
									<span class="detail-value">${reservation.dates.totalNights}ë°•</span>
								</div>
								<div class="detail-item">
									<span class="detail-label">íˆ¬ìˆ™ê°</span>
									<span class="detail-value">ì„±ì¸ ${reservation.occupancy.adults}ëª…</span>
								</div>
							</div>

							<div class="status-section">
								<div class="status-item">
									<span class="status-label">ì˜ˆì•½ ìƒíƒœ</span>
									<span class="status-badge status-confirmed">${reservation.status.reservationText}</span>
								</div>
								<div class="status-item">
									<span class="status-label">ê²°ì œ ìƒíƒœ</span>
									<span class="status-badge ${reservation.status.payment === 0 ? 'status-pending' : 'status-confirmed'}">${reservation.status.paymentText}</span>
								</div>
								<div class="status-item">
									<span class="status-label">ì´ ê²°ì œ ê¸ˆì•¡</span>
									<span class="detail-value">â‚©${reservation.pricing.totalAmount.toLocaleString()}</span>
								</div>
							</div>
						</div>

						<div class="important-info">
							<div class="important-title">ğŸ’¡ ì¤‘ìš” ì•ˆë‚´ì‚¬í•­</div>
							<div class="important-text">
								â€¢ ê²°ì œëŠ” ì²´í¬ì¸ ì‹œ í˜¸í…”ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤<br>
								â€¢ ì˜ˆì•½ ë³€ê²½ì´ë‚˜ ì·¨ì†ŒëŠ” ì²´í¬ì¸ 1ì¼ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤<br>
								â€¢ ì²´í¬ì¸ ì‹œ ì˜ˆì•½ í™•ì¸ ë²ˆí˜¸ì™€ ì‹ ë¶„ì¦ì„ ì§€ì°¸í•´ ì£¼ì„¸ìš”<br>
								â€¢ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ í˜¸í…”ë¡œ ì§ì ‘ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤
							</div>
						</div>

						<div style="background: #f9fafb; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
							<div style="font-weight: 600; margin-bottom: 0.5rem;">í˜¸í…” ì—°ë½ì²˜</div>
							<div style="color: #6b7280; font-size: 0.875rem;">
								ğŸ“ ${reservation.hotel.address}<br>
								ğŸ“ ${reservation.hotel.phone}
							</div>
						</div>

						<div class="action-buttons">
							<button class="btn btn-primary" id="print-btn">
								ğŸ–¨ï¸ ì˜ˆì•½ í™•ì¸ì„œ ì¸ì‡„
							</button>
							<a href="/hotels" class="btn btn-secondary">
								ğŸ¨ ë‹¤ë¥¸ í˜¸í…” ë‘˜ëŸ¬ë³´ê¸°
							</a>
						</div>
					</div>
				`;
			}

			// ì˜¤ë¥˜ í‘œì‹œ
			function showError(message: string) {
				const container = document.getElementById('confirmation-container');
				if (!container) return;

				container.innerHTML = `
					<div class="confirmation-container error">
						<div class="error-icon">âŒ</div>
						<h1 style="color: #dc2626; margin-bottom: 1rem;">ì˜ˆì•½ í™•ì¸ ì‹¤íŒ¨</h1>
						<p style="color: #6b7280; margin-bottom: 2rem;">${message}</p>
						<div class="action-buttons">
							<a href="/hotels" class="btn btn-primary">
								ğŸ¨ í˜¸í…” ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
							</a>
						</div>
					</div>
				`;
			}

			// ë‚ ì§œ í¬ë§·íŒ…
			function formatDate(date: Date): string {
				return date.toLocaleDateString('ko-KR', {
					year: 'numeric',
					month: 'long',
					day: 'numeric',
					weekday: 'short'
				});
			}

			// ì¸ì‡„ ê¸°ëŠ¥
			function printPage() {
				window.print();
			}

			// í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜ˆì•½ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
			document.addEventListener('DOMContentLoaded', () => {
				loadReservationDetails();
				
				// ì¸ì‡„ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
				document.getElementById('print-btn')?.addEventListener('click', printPage);
			});
		</script>

		<Footer />
	</body>
</html>
